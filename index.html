<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Dino Dash</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f7f7f7;
      font-family: monospace;
      overflow: hidden;
      user-select: none;
    }
    canvas {
      display: block;
      margin: 0 auto;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.85.0/dist/phaser.js"></script>
</head>
<body>

<script>
const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 400,
  backgroundColor: "#f7f7f7",
  scale: {
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH
  },
  physics: {
    default: "arcade",
    arcade: {
      gravity: { y: 1600 },
      debug: false  /* FIXED: debug OFF */
    }
  },
  scene: { preload, create, update }
};

let game = new Phaser.Game(config);

let dino, obstacles, ground;
let score = 0;
let gameSpeed = 6;
let jumpVelocity = -450;

function preload() {
  // Dino run frames (pixel art style)
  const g = this.add.graphics();
  
  // Frame 1: legs back
  g.fillStyle(0x000000);
  g.fillRect(2, 24, 12, 12);  // body
  g.fillRect(14, 26, 8, 10); // tail
  g.fillRect(2, 12, 6, 8);   // head
  g.fillRect(0, 20, 4, 8);   // leg1
  g.fillRect(12, 20, 4, 8);  // leg2 back
  g.generateTexture("dino1", 24, 40);
  g.clear();

  // Frame 2: legs forward
  g.fillRect(2, 24, 12, 12);
  g.fillRect(14, 26, 8, 10);
  g.fillRect(2, 12, 6, 8);
  g.fillRect(4, 20, 4, 8);   // leg1 forward
  g.fillRect(16, 20, 4, 8);  // leg2
  g.generateTexture("dino2", 24, 40);
  g.clear();

  // Cactus
  g.fillStyle(0x228B22);
  g.fillRect(0, 16, 8, 24);
  g.fillRect(4, 8, 12, 16);
  g.fillRect(12, 16, 8, 16);
  g.lineStyle(1, 0x006400);
  g.strokeRect(0, 16, 8, 24);
  g.strokeRect(4, 8, 12, 16);
  g.strokeRect(12, 16, 8, 16);
  g.generateTexture("cactus", 24, 48);
  g.destroy();
}

function create() {
  // Ground
  ground = this.add.rectangle(0, 370, 2000, 30, 0xcccccc).setOrigin(0);
  this.physics.add.existing(ground, true);

  // Dino
  dino = this.physics.add.sprite(100, 340, "dino1");
  dino.setBounce(0.05);
  dino.setCollideWorldBounds(false);
  dino.body.setSize(20, 24);
  dino.currentFrame = 0;

  // Obstacles
  obstacles = this.physics.add.group();

  // Input: tap anywhere or SPACE
  this.input.on("pointerdown", jump);
  this.input.keyboard.on("keydown-SPACE", jump);

  // Collisions
  this.physics.add.collider(dino, ground);
  this.physics.add.collider(dino, obstacles, gameOver);
}

function update(time, delta) {
  // Dino animation (run cycle)
  dino.currentFrame = (Math.floor(time / 150) % 2);
  dino.setTexture("dino" + (dino.currentFrame + 1));

  // Auto-run forward
  dino.body.velocity.x = 120 + score * 0.5;

  // Spawn obstacles
  if (time % (2000 - score * 10) < delta) {
    spawnObstacle.call(this);
  }

  // Increase difficulty
  score = Math.floor(dino.x / 10);
  gameSpeed = Math.min(12 + score * 0.02, 25);

  // Recycle old obstacles
  obstacles.children.iterate(obs => {
    if (obs.x < -50) obs.destroy();
  });

  // Score text
  if (!this.scoreText) {
    this.scoreText = this.add.text(16, 16, "0", {
      fontFamily: "monospace",
      fontSize: "24px",
      fill: "#666"
    }).setStroke("#fff", 2);
  }
  this.scoreText.setText(score.toString());
}

function jump() {
  if (dino.body.touching.down) {
    dino.setVelocityY(jumpVelocity);
  }
}

function spawnObstacle() {
  const obs = obstacles.create(850, 346, "cactus");
  obs.body.velocity.x = -(200 + score * 3);
  obs.body.setSize(16, 32);
}

function gameOver() {
  // Simple restart
  this.scene.restart();
  score = 0;
}
</script>

</body>
</html>
